<!doctype html>
<html lang="ko"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="www.thymeleaf.org"
      layout:decorate="~{layout/base.html}"
>
<body>
<div layout:fragment="content">
    <div class="row content">
        <div class="col">
            <!--      부트 스트랩 5.3 Card 컴포넌트 Header and Footer 의 샘플 가져오기-->
            <div class="card">
                <div class="card-header">
                    글조회(read)
                </div>
                <div class="card-body">
                    <form method="post" action="/board/update">
                        <div class="mb-3">
                            <label for="title" class="form-label">제목</label>
                            <input type="text" name="title" class="form-control" id="title" placeholder="제목을 입력해주세요."
                                   th:value="${boardDTO.title}" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="content" class="form-label">내용</label>
                            <textarea readonly type="text" placeholder="내용을 입력해주세요." name="content" rows="5"
                                      class="form-control col-sm-5" id="content">[[${boardDTO.content}]]</textarea>
                        </div>

                        <div class="mb-3">
                            <label for="writer" class="form-label">작성자</label>
                            <input type="text" name="writer" class="form-control" id="writer" placeholder="작성자를 입력해주세요."
                                   th:value="${boardDTO.writer}" readonly>
                        </div>

                        <div class="mb-3">
                            <label for="regDate" class="form-label">등록시간</label>
                            <input type="text" name="regDate" class="form-control" id="regDate"
                                   th:value="${#temporals.format(boardDTO.regDate, 'yyyy-MM-dd HH:mm:ss')}" readonly>
                        </div>

                        <div class="mb-3">
                            <label for="modDate" class="form-label">수정시간</label>
                            <input type="text" name="modDate" class="form-control" id="modDate"
                                   th:value="${#temporals.format(boardDTO.modDate, 'yyyy-MM-dd HH:mm:ss')}" readonly>
                        </div>

                        <div class="mb-3" th:with="link = ${pageRequestDTO.getLink()}">
                            <a th:href="|@{/board/update(bno =${boardDTO.bno})}&${link}|">
                                <button type="button" class="btn btn-primary">수정하기</button>
                            </a>
                            <a th:href="|@{/board/list}?${link}|">
                                <button type="button" class="btn btn-danger">목록가기</button>
                            </a>
                        </div>

                    </form>

                </div>
            </div>
        </div>
        <!--        div row-->
    </div>
    <!--    댓글 목록 출력-->
    <div class="row content mt-3">
        <div class="col">
            <div>
                <button class="btn btn-info addReplyBtn">댓글 작성</button>
                <ul class="list-group replyList mt-3">

                </ul>
            </div>
        </div>
    </div>

    <!--    댓글 목록 페이징 출력-->
    <div class="row content mt-2">
        <div class="col">
            <ul class="pagination replyPaging">

            </ul>
        </div>
    </div>

    <!--    axios 사용하기 위한 도구 설치-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!--    우리가 정의한 /js/reply.js 불러오기-->
    <script src="/js/reply.js"></script>
</div>
<!--끝 나는 부분 layout:fragment="content"-->

<!--자바스크립트 추가하는 영역-->
<script layout:fragment="javascript" th:inline="javascript">
    const bno = [[${boardDTO.bno}]]

    //화면에, 데이터를 넣기 위해서, innerHTML 이용해서, 주입 하기.
    const replyList = document.querySelector(".replyList")
    const replyPaging = document.querySelector(".replyPaging")

    // 댓글을 출력 해주는 함수에서,  innerHTML 이용해서, 주입 하기
    function printReplies(page, size, goLast) {
        // // 주입할 html 태그를 이 변수에 넣을 예정.
        // let str = '';
        getList({bno, page, size, goLast}).then(
            data => {
                // 테스트용
                console.log((data))
                // 서버에서, 통신 후, 받아온 데이터, 안에 dtoList
                printList(data.dtoList)
                // 서버에서, 통신 후 받은 데이터로 페이징 그리기.
                printPages(data)
            }
        ).catch(e => {
            console.error(e)
        })
    }

    // 통신 확인
    printReplies(2, 10)

    /////댓글 목록 , HTML 그리기/////////////////
    function printList(dtoList) {
        // 주입할 html 태그를 이 변수에 넣을 예정.
        let str = '';
        // 기본 유효성 체크.
        if (dtoList && dtoList.length > 0) {
            for (const dto of dtoList) {
                str +=
                    `
<li class="list-group-item d-flex replyItem" >
<span class="col-2">${dto.rno}</span>
<span class="col-6" data-rno="${dto.rno}">${dto.replyText}</span>
<span class="col-2">${dto.replyer}</span>
<span class="col-2">${dto.regDate}</span>
</li>
`
            } //for
        } // if
        replyList.innerHTML = str
    }

    /////댓글 페이징, HTML 그리기/////////////////////////////////////
    function printPages(data) {
        // 문자열로 HTML 요소를 pageStr 담아서, 주입, 그리기 할 예정.
        let pageStr = "";
        // 이전 페이지 여부
        if (data.prev) {
            pageStr += `<li class="page-item"<a class="page-link"
            data-page="${data.start - 1}">Prev</a></li>`
        }

        // 페이징 번호 그리기
        for (let i = data.start; i <= data.end; i++) {
            pageStr += `<li class="page-item ${i == data.page ? "active" : ""}">
<a class="page-link" data-page="${i}">${i}</a>`
        }

        // 다음 페이지 여부
        if (data.next) {
            pageStr += `<li class="page-item"<a class="page-link"
            data-page="${data.end + 1}">Next</a></li>`
        }
        // 위에서 만든 가상의 HTML 요소를 , 특정 요소에 주입하기.
        replyPaging.innerHTML = pageStr
    }

    // 데이터 출력용
    // console.log(getTest(bno))
    // 통신 테스트
    //     async ,await 키워드 이용해서 함수를 호출하니, 반환 되는 타입
    // Promise 약속, 번호표
    // getTest(bno) 데이터를 받아온다면, 그 다음 작업을 then 실행
    // 예외처리, 데이터를 못가져오는 경우, 인터넷이 갑자기 안되어서.
    // getTest(bno).then(data => {
    //     console.log(data)
    // }).catch(e => {
    //     console.error(e)
    // })


</script>

</body>
</html>
